\subsection{Theory}\label{sec:m1:theory}

\subsubsection{Fundamentals}\label{sec:m1:theory:fundamentals}

    If we assume the universe to be homogeneous and isotropic, the line elements $\d s$ is given by the FLWR-metric, here in polar coordinates ~\cite[eq. 1.1.11]{weinberg2008cosmology}:
    \begin{equation}\label{eq:m1:theory:fundamentals:FLWR_line_element}
        \d s^2 = -\d t^2 + e^{2x}\left[ \frac{\d r^2}{1-kr^2}+r^2\d\theta^2 + r^2\sin^2\theta\d\phi^2 \right],
    \end{equation}
    where we have introduced $x = \ln(a)$ which will be our primary measure of time. 

    We further model all forms of energy in the universe as perfect fluids, only characterised by their rest frame density $\rho$ and isotropic pressure $p$, and an equation of state relating the two:
    \begin{equation}\label{eq:m1:theory:fundamentals:equation_of_state}
        \omega=\frac{\rho}{p}.
    \end{equation}
    By conservation of energy and momentum we must satisfy $\nabla_\mu T^\munu=0$, which results in the following differential equations for the density of each fluid $\rho_i$, from ~\cite{AST5220LectureNotes}:
    \begin{equation}\label{eq:m1:theory:fundamentals:density_diff_eq}
        \dv{\rho_i}{t} +3H\rho_i(1+\omega_i) = 0,
    \end{equation}
    where we have introduced the Hubble parameter $H \equiv\dot{a}/a=\d x/\d t$. The solution to ~\cref{eq:m1:theory:fundamentals:density_diff_eq} is of the form:
    \begin{equation}\label{eq:m1:theory:fundamentals:solution_to_density_diff_eq}
        \rho_i \propto e^{-3(1+\omega_i)x},
    \end{equation}
    where $\omega_\mathrm{M} = 0$ (matter), $\omega_\mathrm{rad}=1/3$ (radiation), $\omega_\Lambda=-1$ (cosmological constant) and $\omega_k=-1/3$ (curvature). 

    With these assumptions, the solution to the Einstein equations, \cref{eq:introduction:einstein_equation} are the Friedmann equations ~\cite[ch. 8.3]{carroll_2019}, the first of which describes the expansion rate of the universe:
    \begin{equation}
        \label{eq:m1:theory:fundamentals:first_friedmann_equation}
        H^2 = \frac{8\pi G}{3}\sum_i\rho_i - kc^2\expe{-2x} \\
    \end{equation}
    and the second describe how this expansion rate changes over time:
    \begin{equation}
        \label{eq:m1:theory:fundamentals:second_friedmann_equation}
        \dv{H}{t}+H^2 = -\frac{4\pi G}{3}\sum_i\left(\rho+\frac{3p}{c^2}\right).
    \end{equation}
    As of now, we are primarily interested in the first Friedmann equation. By introducing the critical density, $\rho_c\equiv2H^2/(8\pi G)$, we define the density parameters $\O_i=\rho_i/\rho_c$. We further define the density $\rho_k\equiv-3kc^2\expe{-2x}/(8\pi G)$,\footnote{This is the ``density of curvature'', but is in fact not a real density. It is called this because its mathematical behaviour is similar to that of the other (real) densities.} which enables us to write ~\cref{eq:m1:theory:fundamentals:first_friedmann_equation} as simply:
    \begin{equation}
        1=\sum_i\O_i,
    \end{equation}`
    where the density $\O_k$ is included in the sum. From ~\cref{eq:m1:theory:fundamentals:solution_to_density_diff_eq} we know the evolution of the densities in time, and if we assume the density values today, $\O_{i0}$, are known (or are free parameters), then ~\cref{eq:m1:theory:fundamentals:first_friedmann_equation} may also be written as:
    \begin{equation}\label{eq:m1:theory:fundamentals:Hubble_equation}
        H = H_0\sqrt{\sum_i\O_{i0}\expe{-3(1+\omega_i)x}},
    \end{equation}
    which is the Hubble equation we will use further.


\subsubsection{Measure of time and space}\label{sec:m1:measure_time_space}
    There are many ways of measuring time in cosmology, and they are often related to spatial quantities. The most common is perhaps the \textit{scale factor} $a$, which describes how the physical size of the universe changes with time. An increasing scale factor signifies an expanding universe and vice versa. Another, computationally more useful way of describing $a$ is through its logarithm $x=\ln a \iff a=e^x$, which is the convention we will stick to eventually.
    
    Another way of measuring the expansion of the Universe is through the \textit{redshift} $z$, which is defined as the change in wavelength of electromagnetic radiation between emitter and observer. Radiation propagates through the Universe, so any expansion (or contraction) would expand (or contract) the wavelength, and this is encapsulated in the redshift $z=\Delta\lambda/\lambda$. It is connected to the scale factor as $1+z=1/a$.
    
    Another, perhaps more familiar, time measure is the \textit{cosmic time} $t$. This is the time\footnote{In seconds, months, years, or any other preferred temporal unit (like the duration of a footbal match $\pm$ added time).} measured by a stationary observer (relative to the expanding universe). The statement: \textit{The Universe is somewhat 13 billion years old}, is given in cosmic time, i.e. the time we experience on Earth. 

    Lastly, there is the \textit{conformal time} $\eta$, defined as $\d\eta = c\d te^{-x}$.\footnote{The $c$ is sometimes omitted. $\d\eta = \d te^{-x}$ has units of $\unit{s}$, but multiplied with $c$ yields the distance traversed by a light ray in this time; which is the particle horizon.} This is a measure of distance (or rather the time it would take a light ray to traverse said distance) between points in space, where the expansion of space in between the points is taken into account. We use it to define the \textit{particle horizon}, which is the horizon generated by the maximal conformal time elapsed since the Big Bang. This is how ``far away'' from the Big Bang any light ray could have propagated (expansion of the Universe included). This horizon expands with time, as we would expect, and this is what we mean by conformal time from now on; the extent of the particle horizon, beyond which there cannot be any causal connection to the Big Bang. Thus, this is effectively the size of the causally connected universe. 

    Let's express this mathematically, starting with the cosmic time:
    \begin{equation}\label{eq:m1:theory:measures:cosmic_time}
        t = \int_0^a\frac{\d a}{aH} = \int_{-\infty}^{x}\frac{\d x}{H}.
    \end{equation}
    Using the definition of conformal time, we have:
    \begin{equation}\label{eq:m1:theory:measures:conformal_time}
        \eta = \int_0^a\frac{c\d a}{a^2H} = \int_{-\infty}^{x}\frac{c\d x}{e^xH} \equiv \int_{-\infty}^{x}\frac{c\d x}{\Hp},
    \end{equation}
    where $\Hp=e^xH$ is defined as the \textit{conformal Hubble parameter}. We may then define the \textit{comoving distance}, $\chi$, as the distance to a point, where we take the expansion of space into account, such that it becomes constant (given no relative motion). In contrast, the proper distance between two points increase as the universe increase, the comoving distance remain constant. It is related to the conformal time, and given by:
    \begin{equation}
        \label{eq:m1:theory:measures:conformal ditance}
        \chi = \int_1^a\frac{c\d a}{a^2H} = \int_0^x\frac{c\d x}{\Hp} = \eta_0-\eta,
    \end{equation}
    where $\eta_0$ is the conformal time today, and $\eta$ is the conformal time of the time we are measuring distance to.
    The radial coordinate in the FLRW line element, ~\cref{eq:m1:theory:fundamentals:FLWR_line_element}, is given in terms of the comoving distance and the curvature today $\O_{k0}$ as:
    \begin{equation}\label{eq:m1:theory:measures:r_equation_def}
        r = \begin{cases}
            \chi \cdot \frac{\sin\left(\sqrt{\abs{\O_{k0}}}H_0\chi/c\right)}{\sqrt{\abs{\O_{k0}}}H_0\chi/c} \qquad &\O_{k0} < 0 \\
            \chi \qquad &\O_{k0} = 0 \\
            \chi \cdot \frac{\sinh\left(\sqrt{\abs{\O_{k0}}}H_0\chi/c\right)}{\sqrt{\abs{\O_{k0}}}H_0\chi/c} \qquad &\O_{k0} > 0
        \end{cases}
    \end{equation}
    It is then straigtforward to define the angular diameter distance:
    \begin{equation}\label{eq:m1:theory:measures:angular_distance_def}
        d_A = \expe{x}r,
    \end{equation}
    and the luminosity distance:
    \begin{equation}\label{eq:m1:theory:measures:luminosity_distance}
        d_L = \expe{-x}r,
    \end{equation}
    both of which are derived in \cref{app:derivations}. The temporal quantities $\eta$ and $t$ have the following evolutions with $x$:
    \begin{equation}\label{eq:m1:theory:measures:eta_diffeq}
        \dv{\eta}{x} = \frac{c}{\Hp}.
    \end{equation}
    \begin{equation}\label{eq:m1:theory:measures:t_diffeq}
        \dv{t}{x} = \frac{1}{H}.
    \end{equation}
    Both differential equations are easy to solve numerically. Their derivation may also be found in \cref{app:derivations}

\subsubsection{$\Lambda$CDM-model}\label{sec:m1:lambdaCDM}

    In the $\Lambda$CDM model, the universe consists of matter in terms of baryonic matter ($b$) and cold dark matter (CDM), radiation in terms of photons ($\gamma$) and neutrinos ($\nu$) and dark energy in terms of a cosmological constant ($\Lambda$). In addition, we must allow for some curvature ($k$). As a result, the parameters of the model will be the present values of the Hubble rate, $H_0$, the baryon density $\O_{b0}$, the cold dark matter density $\O_{\mathrm{CDM}0}$, photon density $\O_{\gamma0}$, neutrino density $\O_{\nu0}$, dark energy density $\O_{\Lambda0}$, and the curvature density $\O_{k0}$. The present temperature of the cosmic microwave background radiation $T_{\mathrm{CMB}0}$ fixes the radiation density today through:
    \begin{equation}\label{eq:m1:theory:lambdaCDM:radiation_densities}
        \begin{split}
            \O_{\gamma0} &= \frac{16\pi^3G}{90}\cdot\frac{(k_b T_{\mathrm{CMB}0})^4}{\hbar^3c^5H_0^2}, \\
            \O_{\nu0} &= N_\mathrm{eff} \cdot\frac{7}{8} \cdot \left( \frac{4}{3} \right)^{4/3}\cdot \O_{\gamma0}.
        \end{split}
    \end{equation}
    The total radiation density is $\O_\mathrm{rad}=\O_\gamma+\O_\nu$ and the total matter density is $\O_\mathrm{M} = \O_b+\O_\mathrm{CDM}$.

    The Hubble equation from \cref{eq:m1:theory:fundamentals:Hubble_equation} may be redefined in terms of the conformal Hubble parameter $\Hp$ as:
    \begin{equation}\label{eq:m1:lambdaCDM:conformal_Hubble_equation}
        \begin{split}
            \Hp &= H_0\sqrt{U}\\
            U &\equiv \sum_i\O_{i0}\expe{-\alpha_ix}, 
        \end{split}
    \end{equation}
    where we have defined $\alpha_i\equiv(1+3\omega_i)$ and $i\in\{\mathrm{M}, \mathrm{rad}, \Lambda, k\}$. Since we know the values of the various $\omega_i$ it follows that:
    \begin{equation}
        \label{eq:m1:theory:lambdaCDM:alpha_values}
        \begin{split}
            \alpha_\mathrm{M} &= 1\\
            \alpha_\mathrm{rad} &= 2\\
            \alpha_k &= 0\\
            \alpha_\Lambda &= -2
        \end{split}
    \end{equation}

     Given the evolution of the density parameters with time, where the proportionality constant is the present day density, we introduce the \textit{radiation-matter equality}, i.e. the time radiation and matter densities were equal: $\rho_\mathrm{rad}=\rho_\mathrm{M}$. According to \cref{eq:m1:theory:fundamentals:solution_to_density_diff_eq} this can be expressed as:
     \begin{equation}\label{eq:m1:theory:equalities:radiation_matter}
        \begin{split}
            \rho_\mathrm{rad0}e^{-4x} &= \rho_\mathrm{M0}\expe{-3x} \\
            e^x &= \frac{\rho_\mathrm{rad0}}{\rho_\mathrm{M0}} \implies x_\mathrm{rM} = \ln\left(\frac{\O_\mathrm{rad0}}{\O_\mathrm{M0}}\right),
        \end{split}
     \end{equation}
     where $x_\mathrm{rM}$ now denotes the time of radiation-matter equality. 

     Similarly, the \textit{matter-dark energy equality}, where $\rho_\mathrm{M}=\rho_\Lambda$ can be found to be:
     \begin{equation}\label{eq:m1:theory:equalities:matter_dark_energy}
        \begin{split}
            \rho_\Lambda &= \rho_\mathrm{M0}\expe{-3x} \\
            \implies x_{\mathrm{M}\Lambda} &= \frac{1}{3}\ln\left(\frac{\O_\mathrm{M0}}{\O_\Lambda}\right)
        \end{split}
     \end{equation}
     Since $\Hp$ describes the expansion of the Universe, it is fair to say that the acceleration of the Universe is governed by its second derivative, and the acceleration onset may be found from the extremal point in its first derivative. This means that we find the acceleration onset when:
     \begin{equation}\label{eq:m1:theory:accel_onset_condition}
        \dv{\Hp}{x} = 0 \iff \dv{U}{x} = 0.
     \end{equation}
     This follows from ~\cref{eq:m1:lambdaCDM:conformal_Hubble_equation}. For further details on the derivative, see ~\cref{app:sanity}. We assume dark energy is involved in the acceleration of the universe, and thus assume the contribution from radiation is negligible. ~\cref{eq:m1:theory:accel_onset_condition} is thus further reduced to:
     \begin{equation}\label{eq:m1:theory:accel_onset_definiton}
        \begin{split}
            2\O_{\Lambda0}e^{2x} - \O_\mathrm{M0}e^{-x}&=0\\
            \implies x_\mathrm{accel}&=\frac{1}{3}\ln\left(\frac{\O_\mathrm{M0}}{2\O_{\Lambda0}}\right).
        \end{split}
     \end{equation}
    
    The age of the universe today, and the conformal time today can both be found by evaluating the solutions to the differential equations of $t$ and $\eta$ at the present time (where $x=0$). This is done numerically. 

\subsubsection{Analytical solutions and sanity checks}\label{sec:m1:theory:sanity}
    There are several ways we may check that both our workings and numerical implementations are indeed correct. The simplest way is to always ensure that the sum of all density parameters add up to 1, for all times: $\sum_i\O_i=1$. 
    
    If we only consider the most dominant density parameter, that is $\O_i \gg \sum_{j\neq i}\O_j$, we end up with the following analytical expressions for different temporal regimes:
    \begin{equation}
        \label{eq:m1:theory:sanity:first_deriv_sanity}
        \frac{1}{\Hp}\dv{\Hp}{x} \approx - \frac{\alpha_i}{2} = 
        \begin{cases}
            -1 \qquad &\alpha_\mathrm{rad} = 2 \\
            -\frac{1}{2} \qquad &\alpha_\mathrm{M} = 1\\
            1 \qquad &\alpha_\Lambda = -2
        \end{cases}
    \end{equation}
    \begin{equation}
        \label{eq:m1:theory:sanity:second_deriv_sanity}
        \frac{1}{\Hp}\dv[2]{\Hp}{x} \approx \frac{\alpha_i^2}{4} = 
        \begin{cases}
            1 \qquad &\alpha_\mathrm{rad} = 2 \\
            \frac{1}{4} \qquad &\alpha_\mathrm{M} = 1\\
            1 \qquad &\alpha_\Lambda = -2
        \end{cases}
    \end{equation}
    \begin{equation}
        \label{eq:m1:theory:sanity:conformal_hubble}
        \Hp \approx H_0\sqrt{\O_{i0}e^{-\alpha_ix}} = 
        \begin{cases}
            H_0\sqrt{\O_\mathrm{rad0}}e^{-x} \qquad &\alpha_\mathrm{rad} = 2 \\
            H_0\sqrt{\O_\mathrm{M0}}e^{-x/2} \qquad &\alpha_\mathrm{M} = 1\\
            H_0\sqrt{\O_{\Lambda0}}e^x \qquad &\alpha_\Lambda = -2
        \end{cases}
    \end{equation}
    \begin{equation}
        \label{eq:m1:theory:sanity:eta_sanity}
        \frac{\eta\Hp}{c} \approx 
        \begin{cases}
            1 \qquad &\alpha_\mathrm{rad} = 2 \\
            2 \qquad &\alpha_\mathrm{M} = 1\\
            \infty \qquad &\alpha_\Lambda = -2
        \end{cases}
    \end{equation}
    These equations will be useful when making sure that the implementations are correct.\footnote{~\cref{eq:m1:theory:sanity:eta_sanity} is a bit hand-wavy as $\eta$ is really an integral, so assuming a dominant density parameter, means assuming it for the whole existence of the universe, not only the regime we are looking at. We may hence expect these to bee gradually more wrong as the Universe evolves. \TODO{DO I HAVE TIME TO FIX THIS?}} For a thorough derivation, see \cref{app:sanity}.



